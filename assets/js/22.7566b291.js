(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{377:function(s,t,a){"use strict";a.r(t);var n=a(45),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"原始模型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#原始模型"}},[s._v("#")]),s._v(" 原始模型")]),s._v(" "),a("ul",[a("li",[s._v("浏览器请求静态资源 a.js。（请求头：1KB）")]),s._v(" "),a("li",[s._v("服务器读取磁盘文件 a.js，返给浏览器。（10KB（a.js）+1KB（响应头） = 11KB）")]),s._v(" "),a("li",[s._v("浏览器再次请求，服务器又重新读取磁盘文件 a.js，返给浏览器")]),s._v(" "),a("li",[s._v("如此循环。。")])]),s._v(" "),a("p",[s._v("执行一个往返，流量为 10（a.js）+1（请求头）+1（响应头） = 12KB。\n访问 10 次，流量大约为12 * 10 = 120KB")]),s._v(" "),a("p",[s._v("所以，流量与访问次数有关：\nL（流量） = N（访问次数） * 12")]),s._v(" "),a("p",[s._v("该方式缺点很明显：")]),s._v(" "),a("blockquote",[a("p",[s._v("浪费用户流量。\n浪费服务器资源，服务器要读磁盘文件，然后发送文件到浏览器。\n浏览器要等待 a.js 下载并且执行后才能渲染页面，影响用户体验。")])]),s._v(" "),a("h2",{attrs:{id:"node-service"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#node-service"}},[s._v("#")]),s._v(" Node: service")]),s._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[s._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" res")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" html "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" fs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("readFileSync")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'index.html'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'utf-8'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("send")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\napp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/index.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" res")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" js "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" fs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("readFileSync")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'index.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'utf-8'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("send")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("js"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),a("p",[s._v("HTML静态页面")]),s._v(" "),a("div",{staticClass:"language-HTML extra-class"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("script")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("src")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("index.js"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),a("span",{pre:!0,attrs:{class:"token script"}}),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])])]),a("p",[s._v("示例:每次刷新index.js都会重新发起请求,从服务器获取资源,不管这个文件是否发生过改变")]),s._v(" "),a("blockquote",[a("p",[s._v("demo: cache-control-1")])]),s._v(" "),a("h2",{attrs:{id:"浏览器增加缓存机制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#浏览器增加缓存机制"}},[s._v("#")]),s._v(" 浏览器增加缓存机制")]),s._v(" "),a("ul",[a("li",[s._v("浏览器第一次请求 a.js，缓存 a.js 到本地磁盘。（1+10+1 =12KB）")]),s._v(" "),a("li",[s._v("浏览器再次请求 a.js，直接走浏览器缓存（200，from cache），不再向服务器发起请求。（0KB）")]),s._v(" "),a("li",[s._v("...")])]),s._v(" "),a("p",[s._v("第一次访问，流量为 1+10+1 = 12KB")]),s._v(" "),a("p",[s._v("第二次访问，流量为 0。")]),s._v(" "),a("p",[s._v("。。。")]),s._v(" "),a("p",[s._v("第 10000 次访问，流量依然为 0。\n所以流量与访问次数无关：\nL（流量） = 12KB。\n优点：")]),s._v(" "),a("p",[s._v("大大减少带宽。\n由于减少了 a.js 下载时间，相应的提高了用户体验。")]),s._v(" "),a("p",[s._v("缺点：服务器上 a.js 更新时，浏览器感知不到，拿不到最新的 js 资源。")]),s._v(" "),a("p",[s._v("怎么拿到？")]),s._v(" "),a("h2",{attrs:{id:"关于hash"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#关于hash"}},[s._v("#")]),s._v(" 关于Hash")]),s._v(" "),a("p",[s._v("在webpack中有三种hash可以配置，分别是hash、chunkhash、contenthash，每一种都有不同应用场景,所以首先要搞清楚这三种的hash的区别")]),s._v(" "),a("h3",{attrs:{id:"hash"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#hash"}},[s._v("#")]),s._v(" hash")]),s._v(" "),a("p",[s._v("所有文件哈希值相同，只要改变内容跟之前的不一致，所有哈希值都改变，没有做到缓存意义")]),s._v(" "),a("blockquote",[a("p",[s._v("demo cache-hash/hash")])]),s._v(" "),a("ul",[a("li",[s._v("直接运行webpack看结果，所有文件hash都相同")]),s._v(" "),a("li",[s._v("如果我们改变修改chunk1.js中的代码")]),s._v(" "),a("li",[s._v("再运行webpack发现所有的hash都变化了")]),s._v(" "),a("li")]),s._v(" "),a("h3",{attrs:{id:"chunkhash"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#chunkhash"}},[s._v("#")]),s._v(" chunkhash")]),s._v(" "),a("p",[s._v("当有多个chunk，形成多个bundle时，如果只有一个chunk和一个bundle内容变了，其他的bundle的hash都会发生变化，因为大家都是公用的一个hash，这个时候chunkhash的作用就出来了。它根据不同的入口文件(Entry)进行依赖文件解析、构建对应的 chunk，生成对应的哈希值。")]),s._v(" "),a("blockquote",[a("p",[s._v("修改webpack.config.js里的hash为chunkhash")])]),s._v(" "),a("ul",[a("li",[s._v("在运行webpack，两个chunk的hash并不相同了")]),s._v(" "),a("li",[s._v("在修改chunk1.js")]),s._v(" "),a("li",[s._v("再看webpack，只有修改过的chunk1的hash变化了，达到了我们预期的效果，对我们线上的缓存也是比较好的。")])]),s._v(" "),a("h3",{attrs:{id:"contenthash"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#contenthash"}},[s._v("#")]),s._v(" contenthash")]),s._v(" "),a("p",[s._v("在打包的时候我们会在js中导入css文件，因为他们是同一个入口文件，如果我只改了js得代码，但是他的css抽取生成css文件时候hash也会跟着变换。这个时候contenthash的作用就出来了。")]),s._v(" "),a("p",[s._v("就是说当我们一个js文件里面引用了一个css文件，如果我么修改了css文件内的内容，我们css中的内容，会发发现这整个bundle的hash也会发生更新。\n我们要引入css，并且要把css提出、压缩生成一个css文件，就要借助一个webpack的插件，叫做MiniCssExtractPlugin,他可以帮我提取css到css文件，并且压缩css。")]),s._v(" "),a("blockquote",[a("p",[s._v("demo cache-hash/chunkhash")])]),s._v(" "),a("ul",[a("li",[s._v("运行webpack，index.css和index.js的hash是一样的")]),s._v(" "),a("li",[s._v("修改style.css，运行webpack")]),s._v(" "),a("li",[s._v("只修改了style.css的文件，引入他的index.js确也更新了hash，这个时候就需要contenthash来发挥作用了")]),s._v(" "),a("li",[s._v("修改webpack.config.js，plugins里的chunkhash>contenthash")]),s._v(" "),a("li",[s._v("然后修改common.js，直接运行webpack")]),s._v(" "),a("li",[s._v("看到修改js时我们的css文件的hash并没有变更")])]),s._v(" "),a("blockquote",[a("p",[s._v("https://juejin.cn/post/6844903935812059144\nhttps://juejin.cn/post/6844903717574017031#heading-2\nhttps://juejin.cn/post/6844903517702848526\nhttps://web.dev/http-cache/")])])])}),[],!1,null,null,null);t.default=e.exports}}]);